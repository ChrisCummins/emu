#!/bin/bash

source /usr/local/lib/libemu
EMU_ECHO_PREFIX=$(basename "$0")

set -e

main () {
    # Enable debugging if needed.
    test -n "$EMU_DEBUG" && set -x

    # Parse help argument first.
    for arg in $@; do
        case "$arg" in
            "--help" | "help")
                print_help
                exit 0
                ;;
            "--version")
                print_version
                exit 0
                ;;
        esac
    done

    # Parse short args.
    while getopts ":n" OPT
    do
        case $OPT in
            n)
                EMU_DRY_RUN=1
                ;;
            \?)
                emu_error "invalid option: -$OPTARG"
                exit 1
                ;;
            :)
                emu_error "option -$OPTARG requires an argument"
                exit 1
                ;;
        esac
    done

    # Dispose of args.
    while [ "${1:0:1}" = "-" ]
    do
        shift
    done

    exit 0
}
main $@
