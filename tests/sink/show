set -eu
test_setup

cd $EMU_TEST_DIR/test-source
assert_fail "emu sink"

emu init -v
assert_success "emu sink"

assert_is_not_dir "$EMU_TEST_DIR/test-sink"

echo "emu sink add origin $EMU_TEST_DIR/test-sink"
emu sink add origin $EMU_TEST_DIR/test-sink
echo "emu sink"
if [ "$(emu sink)" != origin ]
then
    exit 5
fi

echo "emu sink -v"
emu sink -v

echo "emu sink add master $EMU_TEST_DIR/test-master"
emu sink add master $EMU_TEST_DIR/test-master
echo "emu sink"
if [ "$(emu sink)" != $(ls .emu/sinks) ]
then
    exit 5
fi

test_teardown
