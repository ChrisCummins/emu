set -eu
test_setup

cd /tmp/emu/test-source

assert_fail "emu snapshot"

emu init -v
emu sink -v add origin ../test-sink

emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot
emu snapshot

assert_strings_match "$(cat ../test-sink/.emu/config/SNAPSHOT-COUNT)" "$(ls ../test-sink/.emu/nodes | wc -l)"
assert_strings_match "$(cat ../test-sink/.emu/config/SNAPSHOT-COUNT)" "$(ls ../test-sink/.emu/trees | wc -l)"

test_teardown
