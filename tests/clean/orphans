set -eux
test_setup

stack=stack

emu init
mkdir -pv $stack
emu stack add origin $stack

emu push
sleep 1
emu push
sleep 1
emu push
cd $stack

node=$(ls .emu/nodes | head -n1)
tree=$(ls .emu/trees | tail -n1)

rm -v .emu/nodes/$node
rm -rfv .emu/trees/$tree

assert_is_not_file .emu/nodes/$node
assert_is_not_dir .emu/trees/$tree

assert_is_dir .emu/trees/$node
assert_is_file .emu/nodes/$tree

set +e
emu clean -n
set -e
assert_is_dir .emu/trees/$node
assert_is_file .emu/nodes/$tree

set +e
EMU_DEBUG= emu clean
set -e
assert_is_not_dir .emu/trees/$node
assert_is_not_file .emu/nodes/$tree

test_teardown
