set -eux
test_setup

stack=../stack

emu init
mkdir -pv $stack
emu stack add origin $stack

emu push
emu push
emu push

node=$(ls $stack/.emu/nodes | head -n1)
tree=$(ls $stack/.emu/trees | tail -n1)

rm -v $stack/.emu/nodes/$node
rm -rfv $stack/.emu/trees/$tree

assert_is_not_file $stack/.emu/nodes/$node
assert_is_not_dir $stack/.emu/trees/$tree

assert_is_dir $stack/.emu/trees/$node
assert_is_file $stack/.emu/nodes/$tree

set +e
emu clean --dry-run --recursive
set -e
assert_is_dir $stack/.emu/trees/$node
assert_is_file $stack/.emu/nodes/$tree

set +e
emu clean --recursive
set -e
assert_is_not_dir $stack/.emu/trees/$node
assert_is_not_file $stack/.emu/nodes/$tree

test_teardown
