set -eux
test_setup

lock=.emu/LOCK
stack=../stack

emu init
echo -e "$(date) $$" > $lock
assert_is_file $lock

set +e
emu clean --dry-run
set -e
assert_is_file $lock

set +e
emu clean
set -e
assert_is_not_file $lock

mkdir -pv $stack
emu stack add origin $stack

echo -e "$(date) $$" > $stack/$lock
assert_is_file $stack/$lock

set +e
emu clean
set -e
assert_is_file $stack/$lock

set +e
emu clean --dry-run --recursive
set -e
assert_is_file $stack/$lock

set +e
emu clean --recursive
set -e
assert_is_not_file $stack/$lock

test_teardown
