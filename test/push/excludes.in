set -eu
test_setup

cd $EMU_TEST_DIR/test-source

emu init
emu sink add origin ../test-sink

assert_is_file .emu/excludes

echo "- test" >> .emu/excludes
echo "hello, world!" > test
emu push

hash=$(ls ../test-sink/.emu/trees)
assert_is_dir ../test-sink/.emu/trees/$hash
assert_is_not_file ../test-sink/.emu/trees/$hash/test

emu prune origin:HEAD

echo "" > .emu/excludes
emu push
hash=$(ls ../test-sink/.emu/trees)
assert_is_dir ../test-sink/.emu/trees/$hash
assert_is_file ../test-sink/.emu/trees/$hash/test


test_teardown
