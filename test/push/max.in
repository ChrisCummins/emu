set -eu
test_setup

cd $EMU_TEST_DIR/test-source

assert_fail "emu push"

emu init -v
emu stack -v add origin ../test-stack

emu push
emu push
emu push
emu push
emu push
emu push
emu push
emu push
emu push
emu push
emu push

assert_strings_match "$(sed -n 's/max number = \?\(.*\)/\1/ip' ../test-stack/.emu/config)" "$(ls ../test-stack/.emu/nodes | wc -l)"
assert_strings_match "$(sed -n 's/max number = \?\(.*\)/\1/ip' ../test-stack/.emu/config)" "$(ls ../test-stack/.emu/trees | wc -l)"

test_teardown
