#!/bin/bash

set -eux
test_setup

exec="$(find @prefix@/bin -type f -name 'emu*' -printf '%f\n')"

# Ensure we have some executables to test.
test -n "$exec" || { echo 'No bins found!'; exit 2; }

for bin in $exec; do
    e=$(basename $bin)

    # man emu-command
    man $e > $e.man
    assert_file_is_not_empty $e.man

    # emu help command
    emu help ${e:4} > $e.emu
    assert_file_is_not_empty $e.emu

    # emu command --help
    $e --help > $e.help
    assert_file_is_not_empty $e.help

    assert_files_match $e.man $e.emu
    rm -f $e.man $e.emu $e.help
done

test_teardown
