set -eu
test_setup

cd $EMU_TEST_DIR/test-source

assert_fail "emu stack"

emu init
emu stack

assert_is_not_dir "$EMU_TEST_DIR/test-stack"

emu stack add origin $EMU_TEST_DIR/test-stack
stack=$(emu stack | sed -r "s/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]//g")

if [ "$stack" != origin ]
then
    exit 5
fi

emu stack -v

emu stack add master $EMU_TEST_DIR/test-master

stack="$(emu stack | sed -r "s/\x1B\[([0-9]{1,2}(;[0-9]{1,2})?)?[m|K]//g")"

if [ "$stack" != $(ls .emu/stacks) ]
then
    exit 5
fi

test_teardown
