set -ue
test_setup

cd /tmp/emu/test-source
echo "emu init -v"
emu init -v

assert_is_not_dir "/tmp/emu/test-sink"

echo "emu sink add origin /tmp/emu/test-sink"
emu sink add origin /tmp/emu/test-sink

assert_is_file ".emu/sinks/origin"
assert_is_dir "/tmp/emu/test-sink"

echo "emu sink -v rm origin"
emu sink -v rm origin

assert_is_not_file ".emu/sinks/origin"
assert_is_dir "/tmp/emu/test-sink"

# Test -R
rm -rvf /tmp/emu/test-sink
echo "emu sink add origin /tmp/emu/test-sink"
emu sink add origin /tmp/emu/test-sink

assert_is_file ".emu/sinks/origin"
assert_is_dir "/tmp/emu/test-sink"

echo "emu sink -Rv rm origin"
emu sink -Rv rm origin

assert_is_not_file ".emu/sinks/origin"
assert_is_not_dir "/tmp/emu/test-sink"

test_teardown
